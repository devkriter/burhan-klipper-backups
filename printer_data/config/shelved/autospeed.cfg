[auto_speed]
#axis: diag_x, diag_y  ; One or multiple of `x`, `y`, `diag_x`, `diag_y`, `z`

#margin: 20            ; How far away from your axes to perform movements

#settling_home: 1      ; Perform settling home before starting Auto Speed
#max_missed: 1.0       ; Maximum full steps that can be missed
#endstop_samples: 3    ; How many endstop samples to take for endstop variance

#accel_min: 1000.0     ; Minimum acceleration test may try
#accel_max: 50000.0    ; Maximum acceleration test may try
#accel_accu: 0.05      ; Keep binary searching until the result is within this percentage

#velocity_min: 50.0    ; Minimum velocity test may try
#velocity_max: 5000.0  ; Maximum velocity test may try
#velocity_accu: 0.05   ; Keep binary searching until the result is within this percentage

#derate: 0.8           ; Derate discovered results by this amount

#validate_margin: Unset      ; Margin for VALIDATE, Defaults to margin
#validate_inner_margin: 20.0 ; Margin for VALIDATE inner pattern
#validate_iterations: 50     ; Perform VALIDATE pattern this many times

#results_dir: ~/printer_data/config ; Destination directory for graphs

[homing_override]
axes: xyz
set_position_z: 0
gcode:
  G90
  #G0 Z5 F600
  {% set home_all = 'X' not in params and 'Y' not in params and 'Z' not in params %}

    {% set x_homed = "x" in printer.toolhead.homed_axes %}
    {% set y_homed = "y" in printer.toolhead.homed_axes %}
    {% set z_homed = "z" in printer.toolhead.homed_axes %}

    {% if not x_homed and not y_homed and not z_homed  %}
        SET_KINEMATIC_POSITION Z=0
        M400
        G91
        G0 Z5 F600
        {% if not home_z %}
            M84
        {% endif %}
    {% else %}
        {% if printer.toolhead.position.z < 5 %}
            G90
            G0 Z5 F600
        {% endif %}
    {% endif %}

  {% if home_all or 'X' in params %}
    G28 X
    M117 "HOME X"
  {% endif %}

  {% if home_all or 'Y' in params %}
    G91
    G1 X-80 F5000
    G28 Y
    M117 "HOME Y"
  {% endif %}

  {% if home_all or 'Z' in params %}
    G90
    G1 X87.5 Y90 F5000
    G28 Z
    M117 "HOME Z"
    G1 Z20
  {% endif %}